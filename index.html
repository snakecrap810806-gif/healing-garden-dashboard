<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>디지털 치유정원 · 실시간 환경 대시보드</title>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@700;800&family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg:#0e1513;
    --card:#0f1916cc;
    --glass:#14221ecc;
    --mint:#3ee2a8;
    --text:#e9f3ef;
    --muted:#9fb5ae;
    --accent:#5af0c4;
    --danger:#ff6b6b;
    --warn:#ffd166;
    --good:#38d996;
    --shadow: 0 12px 24px rgba(0,0,0,.35);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Apple SD Gothic Neo","Nanum Gothic","맑은 고딕",sans-serif;
    background: var(--bg);
    overflow:hidden;
  }
  body::before{
    content:"";
    position:fixed; inset:0; z-index:-1;
    background:
      radial-gradient(1000px 600px at 30% 120%, #13302a 0%, transparent 60%),
      radial-gradient(900px 500px at 80% -10%, #1a3a31 0%, transparent 65%),
      linear-gradient(180deg, rgba(24,36,32,0.85) 0%, rgba(10,15,13,0.95) 70%);
    filter: saturate(1.1);
  }
  .wrap{max-width:1920px; height:100%; margin:0 auto; padding:20px 28px 28px;}
  header{display:flex; align-items:center; gap:24px; flex-wrap:wrap; margin-bottom:14px;}
  .title{
    font-family:"Nanum Gothic", "Noto Sans KR", sans-serif;
    font-weight:800; letter-spacing:-.5px; font-size:40px;
    text-shadow:0 1px 0 #000;
  }
  .timestamp{color:var(--muted); font-size:15px}
  .right{margin-left:auto; display:flex; align-items:center; gap:10px}
  .btn{
    background:linear-gradient(180deg, #1b2b26, #0f1b17);
    color:#cfeee6; border:1px solid #214238; padding:10px 14px; border-radius:12px;
    cursor:pointer; box-shadow:var(--shadow); font-weight:700
  }
  .btn:hover{filter:brightness(1.1)}
  .grid{
    display:grid; grid-template-columns:repeat(4,1fr); grid-template-rows:repeat(2, 1fr);
    gap:18px; height:calc(100% - 90px);
  }
  .card{
    background:linear-gradient(180deg,var(--card), var(--glass));
    backdrop-filter: blur(8px);
    border:1px solid rgba(90,240,196,.25);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:18px 18px 12px;
    display:flex; flex-direction:column;
    min-height:0;
  }
  .card-head{display:flex; align-items:center; gap:10px; margin-bottom:4px}
  .icon{
    width:28px; height:28px; border-radius:8px; display:grid; place-items:center;
    background: #162a24; color:#a9f5dd; font-size:16px; border:1px solid #23493f;
  }
  .name{font-weight:700; letter-spacing:.4px; color:#cfeee6}
  .status-pill{
    margin-left:auto; padding:6px 10px; border-radius:999px; font-size:13px; font-weight:700;
    border:1px solid #1f3f35; color:#07261d; background:var(--good);
  }
  .status-pill.warn{background:var(--warn); color:#3c2a00}
  .status-pill.bad{background:#ff8e8e; color:#3c0000}
  .value-row{display:flex; align-items:baseline; gap:10px; margin:8px 0 6px}
  .value{font-size:44px; font-weight:800; letter-spacing:.5px}
  .unit{color:var(--muted); font-size:18px; font-weight:700}
  .spark-wrap{margin-top:auto}
  .spark{height:72px !important}
  .actions{display:flex; gap:8px; margin-top:10px}
  .mini{font-size:13px; padding:6px 10px; border-radius:10px; border:1px solid #244940; background:#12221d; color:#cfeee6; cursor:pointer}
  .mini:hover{filter:brightness(1.1)}
  .eval{
    grid-column:1 / -1; background:linear-gradient(180deg,var(--card), var(--glass));
    border-radius:var(--radius); border:1px solid rgba(90,240,196,.25); box-shadow:var(--shadow);
    display:flex; align-items:center; gap:12px; padding:14px 18px; color:#d8f5ec;
  }
  .dot{width:10px; height:10px; border-radius:50%; background:var(--good); box-shadow:0 0 12px var(--good)}
  .score{margin-left:auto; font-weight:800; color:#dffaf2}
  .overlay{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:99;}
  .modal{
    width:min(1400px, 70vw); height:min(820px, 70vh); background:#0f1a16; border:1px solid #2b4b41;
    border-radius:18px; box-shadow:var(--shadow); padding:16px; display:flex; flex-direction:column;
  }
  .modal header{margin:0 0 6px 0}
  .modal h3{margin:0; font-size:20px}
  .close{margin-left:auto; background:#172722; color:#cfeee6; border:1px solid #2a4d42; border-radius:10px; padding:6px 10px; cursor:pointer}
  .modal canvas{flex:1}
  @media (max-width:1200px){
    .title{font-size:28px}
    .grid{grid-template-columns:repeat(2, 1fr); grid-template-rows:repeat(4, 1fr)}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">디지털 치유정원 · 실시간 환경 대시보드</div>
      <div id="time" class="timestamp">--:--</div>
      <div class="right">
        <button id="forceRefresh" class="btn">지금 새로고침</button>
      </div>
    </header>

    <section class="grid" id="grid">
      <!-- cards are injected here -->
    </section>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <header>
        <h3 id="modalTitle">그래프</h3>
        <button class="close" id="btnClose">닫기</button>
      </header>
      <canvas id="modalChart"></canvas>
    </div>
  </div>

<script>
// ---------- config ----------
const DEF = {
  updateSec: 30,
  points: 60,
  PM10: 100,
  PM25: 50,
  CO2: 1000,
  TE
