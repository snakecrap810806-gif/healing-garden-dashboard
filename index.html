<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë””ì§€í„¸ ì¹˜ìœ ì •ì›Â·ì‹¤ì‹œê°„ ì •ì› í™˜ê²½ ëŒ€ì‹œë³´ë“œ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg: #f6fbff;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --ok:#0ea5e9;
      --good:#16a34a;
      --bad:#ef4444;
      --ring:#e2e8f0;
      --primary:#2563eb;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{
      font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background: radial-gradient(1200px 600px at 80% -20%, #e8f2ff 0%, transparent 60%) var(--bg);
      background-attachment: fixed;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:28px 16px 48px}
    header{
      display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap;margin-bottom:20px
    }
    .title{
      font-weight:900;letter-spacing:-0.02em;font-size:clamp(22px,3.2vw,36px)
    }
    .subtitle{color:var(--muted);font-size:14px}
    .time{font-weight:700;color:var(--primary)}
    .toolbar{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--ring);background:#fff;padding:10px 14px;border-radius:10px;
      font-weight:700;cursor:pointer
    }
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
    .grid{
      display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:10px
    }
    .card{
      grid-column:span 6;background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:18px;
      box-shadow:0 8px 30px rgba(2,6,23,.06);display:flex;align-items:center;gap:14px;cursor:pointer
    }
    @media(min-width:900px){.card{grid-column:span 3}}
    .icon{
      width:54px;height:54px;border-radius:12px;display:grid;place-items:center;font-size:26px;
      background:linear-gradient(135deg,#eff6ff,#ecfeff)
    }
    .label{font-weight:900;letter-spacing:-0.02em}
    .value{font-size:26px;font-weight:900}
    .unit{color:var(--muted);margin-left:6px;font-weight:700}
    .pill{
      margin-left:auto;font-size:13px;font-weight:900;border-radius:999px;padding:6px 10px;border:1px solid var(--ring);
      color:var(--muted);background:#fff
    }
    .pill.good{color:#166534;background:#ecfdf5;border-color:#a7f3d0}
    .pill.warn{color:#a16207;background:#fffbeb;border-color:#fde68a}
    .pill.bad{color:#991b1b;background:#fef2f2;border-color:#fecaca}
    .foot{
      margin-top:18px;background:#ffffffcc;border:1px solid var(--ring);backdrop-filter:blur(4px);
      border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:10px
    }
    .dot{width:10px;height:10px;border-radius:50%;background:var(--good)}
    .score{font-weight:900}
    .logos{margin-left:auto;display:flex;align-items:center;gap:16px;opacity:.9}
    .logos img{height:26px;object-fit:contain}
    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:50}
    .modal.show{display:flex}
    .backdrop{position:absolute;inset:0;background:rgba(15,23,42,.55);backdrop-filter:blur(2px)}
    .sheet{
      position:relative;width:min(1100px,94vw);height:min(56vh,520px);background:#fff;border-radius:18px;
      border:1px solid var(--ring);padding:14px 14px 8px;box-shadow:0 24px 80px rgba(2,6,23,.3);z-index:1
    }
    .sheet header{margin:0 4px 6px}
    .close{
      position:absolute;top:10px;right:10px;border:none;background:#0f172a;color:#fff;border-radius:10px;padding:8px 10px;
      font-weight:800;cursor:pointer
    }
    canvas{border-radius:10px;background:#fbfdff;border:1px solid var(--ring)}
    /* ensures mobile taps are captured by the iframe area */
    .sheet, .card, .btn {touch-action:manipulation}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">ë””ì§€í„¸ ì¹˜ìœ ì •ì›Â·ì‹¤ì‹œê°„ ì •ì› í™˜ê²½ ëŒ€ì‹œë³´ë“œ</div>
        <div class="subtitle"><span class="time" id="now">--:--:--</span> Â· <span id="cycle">30ì´ˆ ê°„ê²© ì—…ë°ì´íŠ¸</span></div>
      </div>
      <div class="toolbar">
        <button class="btn" id="btnAll">ì „ì²´ ê·¸ë˜í”„</button>
        <button class="btn primary" id="btnRefresh">ì§€ê¸ˆ ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </header>

    <!-- KPI Cards -->
    <section class="grid" id="cards">
      <!-- JSê°€ ì±„ì›€ -->
    </section>

    <!-- Summary / Logos -->
    <div class="foot">
      <span class="dot"></span>
      <span class="score" id="summaryText">ì¢…í•© í‰ê°€: ì¾Œì </span>
      <div class="logos">
        <!-- âœ… ì—¬ê¸°ì— ë³¸ì¸ GitHubì— ì˜¬ë¦° ë¡œê³  URLë¡œ êµì²´í•˜ì„¸ìš” -->
        <img src="https://dummyimage.com/240x40/ffffff/9aa2b1&text=%EA%B5%AD%EB%A6%BD%EC%A0%95%EC%9B%90%EB%AC%B8%ED%99%94%EC%9B%90" alt="êµ­ë¦½ì •ì›ë¬¸í™”ì› ë¡œê³ ">
        <img src="https://dummyimage.com/120x40/ffffff/0f172a&text=Upbit" alt="Upbit ë¡œê³ ">
        <img src="https://dummyimage.com/120x40/ffffff/0f172a&text=%EB%91%90%EB%82%98%EB%AC%B4" alt="ë‘ë‚˜ë¬´ ë¡œê³ ">
      </div>
    </div>
  </div>

  <!-- Chart Modal -->
  <div class="modal" id="modal">
    <div class="backdrop" data-close></div>
    <div class="sheet">
      <header>
        <div class="title" id="modalTitle" style="font-size:18px">ê·¸ë˜í”„</div>
      </header>
      <button class="close" data-close>ë‹«ê¸°</button>
      <canvas id="chart"></canvas>
    </div>
  </div>

<script>
/* -----------------------------
   0) ì„¤ì • (í•„ìš” ì‹œ ìˆ«ìë§Œ ê³ ì¹˜ì„¸ìš”)
--------------------------------*/
const UPDATE_MS = 30_000;          // 30ì´ˆ ì£¼ê¸°
const HISTORY_LEN = 120;           // ìµœëŒ€ 120ê°œ í¬ì¸íŠ¸(ì•½ 1ì‹œê°„)
const limits = {
  pm10: 100,       // Âµg/mÂ³
  pm25: 50,        // Âµg/mÂ³
  co2: 1000,       // ppm
  temp: {min: -10, max: 40, good:[18,27]},
  humi: {min: 10, max: 90, good:[35,65]}
};
// ê¸°ë³¸ ì¤‘ì‹¬ê°’(ê°€ì„ ëŠë‚Œ, ì•„ì£¼ ì¡°ê¸ˆë§Œ ì¶œë )
const base = {
  pm10: 26,   // Âµg/mÂ³
  pm25: 13,   // Âµg/mÂ³
  co2: 430,   // ppm
  temp: 18.6, // â„ƒ
  humi: 55.0  // %RH
};
// yì¶• ë²”ìœ„(ê·¸ë˜í”„ë¥¼ ì™„ë§Œí•˜ê²Œ)
const yRanges = {
  pm10: [0, 140],
  pm25: [0, 80],
  co2 : [300, 1200],
  temp: [ -5, 35],
  humi: [ 20, 90]
};
// í•­ëª© ë©”íƒ€
const METAS = {
  pm10: {label:'PM10', unit:'Âµg/mÂ³', icon:'ğŸŒ«ï¸'},
  pm25: {label:'PM2.5', unit:'Âµg/mÂ³', icon:'ğŸ™ï¸'},
  co2 : {label:'COâ‚‚', unit:'ppm', icon:'ğŸ«'},
  temp: {label:'ì˜¨ë„', unit:'â„ƒ', icon:'ğŸŒ¡ï¸'},
  humi: {label:'ìŠµë„', unit:'%RH', icon:'ğŸ’§'},
};

/* -----------------------------
   1) ìƒíƒœ
--------------------------------*/
const state = {
  now: new Date(),
  data: {...base},
  history: {
    pm10:[], pm25:[], co2:[], temp:[], humi:[], time:[]
  }
};

/* -----------------------------
   2) ë„ìš°ë¯¸
--------------------------------*/
const $ = sel => document.querySelector(sel);
const fmt = n => {
  // ì†Œìˆ˜ í•œ ìë¦¬(ì˜¨ë„/ìŠµë„), ë‚˜ë¨¸ì§€ëŠ” í•œ ìë¦¬(ë¯¸ì„¸ë¨¼ì§€), CO2ëŠ” ì •ìˆ˜
  if (Number.isNaN(n)) return '-';
  return Math.round(n * 10) / 10;
};
const prettyTime = d => d.toLocaleString('ko-KR', {year:'numeric',month:'numeric',day:'numeric',
                                                   hour:'numeric',minute:'2-digit',second:'2-digit'});

function statusFor(key,val){
  if (key==='pm10') return val<=limits.pm10 ? 'ì¢‹ìŒ' : 'ìœ„í—˜';
  if (key==='pm25') return val<=limits.pm25 ? 'ì¢‹ìŒ' : 'ìœ„í—˜';
  if (key==='co2')  return val<=limits.co2  ? 'ì¢‹ìŒ' : 'ìœ„í—˜';
  if (key==='temp'){
    const [a,b]=limits.temp.good; return (val>=a && val<=b)?'ì¢‹ìŒ':'ì£¼ì˜';
  }
  if (key==='humi'){
    const [a,b]=limits.humi.good; return (val>=a && val<=b)?'ì¢‹ìŒ':'ì£¼ì˜';
  }
  return 'ì •ë³´';
}
function pillClass(txt){
  if (txt==='ì¢‹ìŒ') return 'good';
  if (txt==='ìœ„í—˜') return 'bad';
  return 'warn';
}

// ê°’ ëœë¤ ì›Œí¬ (ì•„ì£¼ ì‘ì€ ë³€í™”)
function jitter(current, step=0.35){
  return current + (Math.random()-0.5)*step;
}
function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

function nextValues(prev){
  // ë¯¸ì„¸ë¨¼ì§€ëŠ” ì•„ì£¼ ë¯¸ì„¸í•˜ê²Œ ë³€ë™, ê°€ë” ì•„ì£¼ í¬ë¯¸í•œ ìŠ¤íŒŒì´í¬
  const spike = Math.random()<0.08 ? (Math.random()*2.5) : 0; // 8% í™•ë¥ ë¡œ +ìµœëŒ€ 2.5
  const pm10 = Math.max(2, jitter(prev.pm10, 0.6) + spike);
  const pm25 = Math.max(1, jitter(prev.pm25, 0.4) + spike*0.6);
  // CO2ëŠ” ì‹¤ë‚´ ê¸°ì¤€ ì™„ë§Œ
  const co2  = clamp(jitter(prev.co2, 6), 350, 1100);
  // ì˜¨ë„/ìŠµë„ëŠ” ê³ ì • ë²”ìœ„ì—ì„œ ë§¤ìš° ì™„ë§Œ
  const temp = clamp(jitter(prev.temp, 0.12), limits.temp.min, limits.temp.max);
  const humi = clamp(jitter(prev.humi, 0.5), limits.humi.min, limits.humi.max);
  return {pm10, pm25, co2, temp, humi};
}

function pushHistory(){
  const t = new Date();
  state.history.time.push(t);
  ['pm10','pm25','co2','temp','humi'].forEach(k=>{
    state.history[k].push(state.data[k]);
    if (state.history[k].length > HISTORY_LEN) state.history[k].shift();
  });
  if (state.history.time.length > HISTORY_LEN) state.history.time.shift();
}

/* -----------------------------
   3) ë Œë”ë§
--------------------------------*/
function renderTime(){
  state.now = new Date();
  $('#now').textContent = prettyTime(state.now);
}

function renderCards(){
  const container = $('#cards');
  container.innerHTML = '';
  const order = ['pm10','pm25','temp','humi']; // í™”ë©´ 4ê°œ ì¹´ë“œ
  order.forEach(key=>{
    const meta = METAS[key];
    const val = state.data[key];
    const status = statusFor(key,val);
    const card = document.createElement('button');
    card.className = 'card';
    card.setAttribute('data-key', key);
    card.innerHTML = `
      <div class="icon" aria-hidden="true">${meta.icon}</div>
      <div style="text-align:left">
        <div class="label">${meta.label}</div>
        <div class="value">${key==='co2' ? Math.round(val) : fmt(val)} <span class="unit">${meta.unit}</span></div>
      </div>
      <div class="pill ${pillClass(status)}">${status}</div>
    `;
    card.addEventListener('click', ()=> openChart(key));
    container.appendChild(card);
  });

  // ì¢…í•©í‰ê°€
  const ok = (state.data.pm10<=limits.pm10) && (state.data.pm25<=limits.pm25) && (state.data.co2<=limits.co2)
            && (state.data.temp>=limits.temp.good[0] && state.data.temp<=limits.temp.good[1])
            && (state.data.humi>=limits.humi.good[0] && state.data.humi<=limits.humi.good[1]);
  $('#summaryText').textContent = `ì¢…í•© í‰ê°€: ${ok?'ì¾Œì ':'ë³´í†µ/ì£¼ì˜'}`;
}

/* -----------------------------
   4) ì°¨íŠ¸
--------------------------------*/
let chart;
function buildChart(){
  const ctx = $('#chart').getContext('2d');
  chart = new Chart(ctx,{
    type:'line',
    data:{ labels:[], datasets:[{label:'', data:[], fill:true, tension:.25}]},
    options:{
      maintainAspectRatio:false,
      responsive:true,
      interaction:{mode:'nearest',intersect:false},
      scales:{
        x:{grid:{color:'rgba(148,163,184,.25)'}, ticks:{maxRotation:0,autoSkip:true}},
        y:{grid:{color:'rgba(148,163,184,.20)'}, ticks:{precision:0}}
      },
      plugins:{
        legend:{display:false},
        tooltip:{mode:'index',intersect:false}
      }
    }
  });
}
function openChart(key){
  const meta = METAS[key];
  $('#modalTitle').textContent = `${meta.label} ì‹œê°„ëŒ€ë³„ ì¸¡ì •ê°’ (${meta.unit})`;
  // ë°ì´í„° ë°”ì¸ë”©
  chart.data.labels = state.history.time.map(t=> t.toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}));
  chart.data.datasets[0].label = meta.label;
  chart.data.datasets[0].data = state.history[key];
  chart.data.datasets[0].borderColor = 'rgba(14,165,233,1)';
  chart.data.datasets[0].backgroundColor = 'rgba(14,165,233,.15)';
  // y ë²”ìœ„
  const [minY,maxY] = yRanges[key];
  chart.options.scales.y.min = minY;
  chart.options.scales.y.max = maxY;
  chart.update();
  $('#modal').classList.add('show');
}
function closeChart(){ $('#modal').classList.remove('show'); }

/* -----------------------------
   5) ì£¼ê¸° ì—…ë°ì´íŠ¸
--------------------------------*/
function tick(updateHistory=true){
  state.data = nextValues(state.data);
  if (updateHistory) pushHistory();
  renderTime();
  renderCards();
}

/* -----------------------------
   6) ì´ˆê¸°í™”
--------------------------------*/
function init(){
  // ì´ˆê¸° ì´ë ¥ ì±„ìš°ê¸°(ê·¸ë˜í”„ê°€ ë¹ˆ í™”ë©´ì´ ë˜ì§€ ì•Šë„ë¡ 20í¬ì¸íŠ¸ ë¯¸ë¦¬ ìƒì„±)
  state.data = {...base};
  for(let i=0;i<20;i++){ state.data = nextValues(state.data); pushHistory(); }
  renderTime(); renderCards(); buildChart();

  // ì´ë²¤íŠ¸
  $('#btnRefresh').addEventListener('click', ()=> tick(true));
  $('#btnAll').addEventListener('click', ()=> openChart('pm10'));
  document.querySelectorAll('[data-close]').forEach(el=> el.addEventListener('click', closeChart));

  // ì£¼ê¸°
  setInterval(()=> tick(true), UPDATE_MS);
  // ì‹œê³„ 1ì´ˆ ê°±ì‹ 
  setInterval(renderTime, 1000);
}
init();
</script>
</body>
</html>
